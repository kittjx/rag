# ğŸš€ éƒ¨ç½²æ€»ç»“

## ğŸ“¦ Docker éƒ¨ç½²æ–¹æ¡ˆå·²å®Œæˆ

æ­å–œï¼æ‚¨çš„çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿç°åœ¨æ”¯æŒå®Œæ•´çš„ Docker å®¹å™¨åŒ–éƒ¨ç½²ã€‚

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

### Docker é…ç½®æ–‡ä»¶
- âœ… `Dockerfile` - å¤šé˜¶æ®µæ„å»ºçš„åº”ç”¨é•œåƒ
- âœ… `docker-compose.yml` - å®Œæ•´çš„æœåŠ¡ç¼–æ’é…ç½®
- âœ… `.dockerignore` - Docker æ„å»ºä¼˜åŒ–

### éƒ¨ç½²è„šæœ¬
- âœ… `docker-build.sh` - æ„å»º Docker é•œåƒ
- âœ… `docker-deploy.sh` - éƒ¨ç½²æœåŠ¡ï¼ˆæ”¯æŒå‰å°/åå°è¿è¡Œï¼‰
- âœ… `docker-stop.sh` - åœæ­¢æœåŠ¡
- âœ… `test-docker.sh` - Docker ç¯å¢ƒæµ‹è¯•

### æ–‡æ¡£
- âœ… `DOCKER_DEPLOYMENT.md` - å®Œæ•´çš„ Docker éƒ¨ç½²æŒ‡å—
- âœ… `README.md` - å·²æ›´æ–°ï¼ŒåŒ…å« Docker éƒ¨ç½²è¯´æ˜
- âœ… `Makefile` - å·²æ·»åŠ  Docker ç›¸å…³å‘½ä»¤

## ğŸ¯ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Compose                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚
â”‚  â”‚   Redis      â”‚  â”‚   API        â”‚  â”‚   Web UI     â”‚  â”‚
â”‚  â”‚   (Cache)    â”‚  â”‚   (FastAPI)  â”‚  â”‚   (HTTP)     â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚
â”‚  â”‚   :6379      â”‚  â”‚   :8000      â”‚  â”‚   :8080      â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                 â”‚                  â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    rag-network                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                  â”‚
         â–¼                 â–¼                  â–¼
    Redis Data      Vector Store         Web Files
    (Volume)        (Mounted)            (Mounted)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. æµ‹è¯• Docker ç¯å¢ƒ
bash test-docker.sh

# 2. æ„å»ºé•œåƒ
bash docker-build.sh

# 3. å¯åŠ¨æœåŠ¡
bash docker-deploy.sh

# 4. è®¿é—®æœåŠ¡
# API: http://localhost:8000
# Web: http://localhost:8080
```

### æ–¹æ³•2: ä½¿ç”¨ Makefile

```bash
# æ„å»º
make docker-build

# å¯åŠ¨
make docker-up

# æŸ¥çœ‹çŠ¶æ€
make docker-ps

# æŸ¥çœ‹æ—¥å¿—
make docker-logs

# åœæ­¢
make docker-down
```

### æ–¹æ³•3: ä½¿ç”¨ docker-compose

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

## ğŸ“‹ æœåŠ¡è¯´æ˜

### 1. Redis æœåŠ¡
- **é•œåƒ**: `redis:7-alpine`
- **ç«¯å£**: `6379`
- **ç”¨é€”**: ç¼“å­˜æŸ¥è¯¢ç»“æœ
- **æ•°æ®æŒä¹…åŒ–**: `redis-data` volume

### 2. API æœåŠ¡
- **é•œåƒ**: è‡ªå®šä¹‰æ„å»ºï¼ˆåŸºäº Python 3.11ï¼‰
- **ç«¯å£**: `8000`
- **åŠŸèƒ½**: 
  - FastAPI åç«¯
  - å‘é‡æ£€ç´¢
  - LLM é—®ç­”
  - æµå¼å“åº”
- **æŒ‚è½½ç›®å½•**:
  - `./data` - æ•°æ®ç›®å½•
  - `./logs` - æ—¥å¿—ç›®å½•
  - `./models` - æ¨¡å‹ç›®å½•

### 3. Web UI æœåŠ¡
- **é•œåƒ**: ä¸ API ç›¸åŒ
- **ç«¯å£**: `8080`
- **åŠŸèƒ½**: ChatGPT é£æ ¼çš„ Web ç•Œé¢
- **æŒ‚è½½ç›®å½•**: `./web` - Web æ–‡ä»¶

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# å¯åŠ¨ç‰¹å®šæœåŠ¡
docker-compose up -d api

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
docker-compose logs -f api
docker-compose logs -f web
```

### çŸ¥è¯†åº“ç®¡ç†

```bash
# æ„å»ºçŸ¥è¯†åº“
docker-compose exec api python scripts/build_knowledge_base.py

# æŸ¥çœ‹ç»Ÿè®¡
docker-compose exec api python scripts/manage_kb.py stats

# åˆ—å‡ºæ–‡æ¡£
docker-compose exec api python scripts/manage_kb.py list
```

### è°ƒè¯•

```bash
# è¿›å…¥å®¹å™¨
docker-compose exec api bash

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
docker-compose exec api env

# æµ‹è¯• Redis è¿æ¥
docker-compose exec api ping redis
docker-compose exec redis redis-cli ping
```

## ğŸ“Š èµ„æºä½¿ç”¨

### é»˜è®¤é…ç½®
- **CPU**: æ— é™åˆ¶ï¼ˆå¯åœ¨ docker-compose.yml ä¸­é…ç½®ï¼‰
- **å†…å­˜**: æ— é™åˆ¶ï¼ˆå»ºè®®è‡³å°‘ 4GBï¼‰
- **ç£ç›˜**: çº¦ 5-10GBï¼ˆå–å†³äºæ¨¡å‹å’Œæ•°æ®ï¼‰

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

åœ¨ `docker-compose.yml` ä¸­æ·»åŠ èµ„æºé™åˆ¶ï¼š

```yaml
services:
  api:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G
```

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ç¯å¢ƒå˜é‡
- âœ… ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯
- âœ… ä¸è¦å°† `.env` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Docker secrets

### 2. ç½‘ç»œå®‰å…¨
- âœ… ä¸è¦æš´éœ² Redis ç«¯å£åˆ°å…¬ç½‘
- âœ… ä½¿ç”¨åå‘ä»£ç†ï¼ˆNginxï¼‰
- âœ… å¯ç”¨ HTTPS

### 3. ç”¨æˆ·æƒé™
- âœ… å®¹å™¨å†…ä½¿ç”¨é root ç”¨æˆ·ï¼ˆå·²å®ç°ï¼‰
- âœ… é™åˆ¶æ–‡ä»¶æƒé™

## ğŸ“ˆ æ‰©å±•éƒ¨ç½²

### æ°´å¹³æ‰©å±•

```bash
# æ‰©å±• API æœåŠ¡åˆ° 3 ä¸ªå®ä¾‹
docker-compose up -d --scale api=3

# éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼ˆNginxï¼‰
```

### ä½¿ç”¨ Docker Swarm

```bash
# åˆå§‹åŒ– Swarm
docker swarm init

# éƒ¨ç½² stack
docker stack deploy -c docker-compose.yml rag

# æ‰©å±•æœåŠ¡
docker service scale rag_api=3
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **å®¹å™¨æ— æ³•å¯åŠ¨**
   ```bash
   docker-compose logs api
   docker-compose config
   ```

2. **æ— æ³•è¿æ¥ Redis**
   ```bash
   docker-compose exec api ping redis
   docker network inspect rag_rag-network
   ```

3. **å†…å­˜ä¸è¶³**
   ```bash
   docker stats
   # å¢åŠ  Docker Desktop å†…å­˜é™åˆ¶
   ```

4. **ç«¯å£å†²çª**
   ```bash
   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
   ports:
     - "9000:8000"  # ä½¿ç”¨ 9000 ä»£æ›¿ 8000
   ```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[DOCKER_DEPLOYMENT.md](DOCKER_DEPLOYMENT.md)** - å®Œæ•´çš„ Docker éƒ¨ç½²æŒ‡å—
- **[README.md](README.md)** - é¡¹ç›®æ€»è§ˆ
- **[WEB_INTERFACE_GUIDE.md](WEB_INTERFACE_GUIDE.md)** - Web ç•Œé¢ä½¿ç”¨æŒ‡å—
- **[LLM_BACKENDS.md](LLM_BACKENDS.md)** - LLM åç«¯é…ç½®

## ğŸ‰ æ€»ç»“

### ä¼˜åŠ¿

âœ… **ä¸€é”®éƒ¨ç½²** - ç®€åŒ–éƒ¨ç½²æµç¨‹  
âœ… **ç¯å¢ƒéš”ç¦»** - é¿å…ä¾èµ–å†²çª  
âœ… **æ˜“äºæ‰©å±•** - æ”¯æŒæ°´å¹³æ‰©å±•  
âœ… **ä¾¿äºç»´æŠ¤** - ç»Ÿä¸€ç®¡ç†æœåŠ¡  
âœ… **å¿«é€Ÿæ¢å¤** - å®¹å™¨åŒ–å¤‡ä»½æ¢å¤  
âœ… **è·¨å¹³å°** - åœ¨ä»»ä½•æ”¯æŒ Docker çš„ç³»ç»Ÿä¸Šè¿è¡Œ  

### ä¸‹ä¸€æ­¥

1. âœ… **æµ‹è¯•éƒ¨ç½²**: `bash test-docker.sh`
2. âœ… **æ„å»ºé•œåƒ**: `bash docker-build.sh`
3. âœ… **å¯åŠ¨æœåŠ¡**: `bash docker-deploy.sh`
4. âœ… **è®¿é—®ç•Œé¢**: http://localhost:8080
5. âœ… **æ„å»ºçŸ¥è¯†åº“**: æ·»åŠ æ–‡æ¡£å¹¶æ„å»º
6. âœ… **å¼€å§‹ä½¿ç”¨**: äº«å—æ™ºèƒ½é—®ç­”ï¼

## ğŸ’¡ æç¤º

- é¦–æ¬¡å¯åŠ¨ä¼šä¸‹è½½æ¨¡å‹ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 10GBï¼‰
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS å’Œåå‘ä»£ç†
- å®šæœŸå¤‡ä»½ `data/` ç›®å½•

---

**å¼€å§‹ä½¿ç”¨**:
```bash
bash docker-build.sh && bash docker-deploy.sh
```

**è®¿é—®**: http://localhost:8080

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸš€

